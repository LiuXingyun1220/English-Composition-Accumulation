### 一、 核心公式

无论哪种模式，最终要求的占比 $R$ 都是：

$$R = \frac{\text{每秒钟 CPU 用于 I/O 处理的时间}}{\text{1 秒钟的时间 (即 1s)}} \times 100\%$$

或者用时钟周期来算：

$$R = \frac{\text{每秒钟 CPU 用于 I/O 的时钟周期数}}{\text{CPU 主频 (每秒总周期数)}} \times 100\%$$

---

### 二、 场景一：中断驱动方式 (Interrupt-Driven)


场景描述：设备没准备好时 CPU 干别的；设备准备好一个字（或一个字节）后，发中断，CPU 暂停当前工作，花时间去搬运这一个字。

#### 📘 计算步骤：

Step 1: 计算中断频率 ($f_{int}$)

即：CPU 每秒钟要处理多少次中断？

- 如果题目给的是数据传输率 ($B$) 和 输入缓冲器大小 ($Data_{size}$)：
    
    $$f_{int} = \frac{B}{Data_{size}}$$
    
    - _注意：$B$ 的单位通常是 bps 或 B/s，$Data_{size}$ 通常是“1个字”或“1个字节”。注意单位换算！_
        

Step 2: 确定单次中断的 CPU 开销 ($T_{once}$)

即：处理一次中断，CPU 要忙活多久？

- 题目通常直接给出：“处理一次中断需要 $N$ 个时钟周期” 或 “需要 $T$ 秒”。
    
- 如果题目给的很细，包括“中断响应时间”、“中断服务时间”、“恢复现场时间”，则需要**加总**。
    

Step 3: 套入公式

$$CPU占比 = \frac{f_{int} \times T_{once}}{\text{CPU 主频}} \times 100\%$$

#### 💡 举例：

> 假设磁盘数据传输率为 $1MB/s$，每次传输 $32bit$（4B）数据产生一次中断。CPU 主频 $500MHz$，处理一次中断需 $200$ 个时钟周期。
> 
> 1. **中断频率**：$1MB/s \div 4B = 250,000 \text{次/秒}$。
>     
> 2. **总开销**：$250,000 \times 200 = 50,000,000$ 个周期。
>     
> 3. **占比**：$50,000,000 \div 500,000,000 = 10\%$。
>     

---

### 三、 场景二：DMA 方式 (Direct Memory Access)

**场景描述**：CPU 只有在**开始**（预处理）和**结束**（后处理）时才介入。中间的数据搬运由 DMA 控制器搞定（此时 CPU 可能会被挪用总线周期，但通常不计入 CPU 执行程序的开销时间，除非题目问的是“总线占用率”）。

#### 📘 计算步骤：

Step 1: 计算“块”频率 ($f_{block}$)

即：每秒钟传输多少个“数据块”？

- DMA 是按块传输的。
    
    $$f_{block} = \frac{\text{数据传输率 } B}{\text{数据块大小 } Block_{size}}$$
    

Step 2: 确定单次 DMA 的 CPU 开销 ($T_{DMA}$)

即：CPU 处理一个块，需要花多少时间做管理工作？

- $T_{DMA}$ = **预处理时间** (初始化 DMA 寄存器) + **后处理时间** (结束中断)。
    
- _注意：中间传数据的时间是 DMA 控制器干的，CPU 不算在内。_
    

Step 3: 套入公式

$$CPU占比 = \frac{f_{block} \times T_{DMA}}{\text{CPU 主频}} \times 100\%$$

#### 💡 举例：

> 同上题环境。$1MB/s$。DMA 方式每次传输 $4KB$ 一个块。预处理需 $500$ 周期，后处理需 $300$ 周期。
> 
> 1. **块频率**：$1MB/s \div 4KB = 1024 / 4 = 256 \text{次/秒}$。
>     
> 2. **单次开销**：$500 + 300 = 800$ 周期。
>     
> 3. **总开销**：$256 \times 800 = 204,800$ 周期。
>     
> 4. 占比：$204,800 \div 500,000,000 \approx 0.04\%$。
>     
>     (对比中断方式的 10%，可见 DMA 效率极高)
>     

---

### 四、 场景三：周期挪用 (Cycle Stealing) —— 特殊考法

如果题目问的是 **“DMA 挪用了多少 CPU 周期”** 或者 **“CPU 实际上被拖慢了多少”**，而不是问“CPU 执行指令的时间占比”，算法略有不同。

- **原理**：DMA 每传送一个**字**（不是块），就要强行占用一个总线周期（存取周期）。此时 CPU 没法访存，只能暂停。
    
- 计算：
    
    $$挪用占比 = \frac{\text{每秒传送的字数 (Word Count)}}{\text{CPU 内存存取周期频率}}$$
    
    - _注意：这里比的是“字”的频率，因为挪用是按字进行的。_
        
